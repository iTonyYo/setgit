#!/usr/bin/env node
"use strict";var e=require("meow"),t=require("update-notifier"),r=require("is-git-repository"),a=require("redent"),i=require("gradient-string"),s=require("chalk"),o=require("cosmiconfig"),l=require("nodegit"),n=require("async/eachOfSeries"),c=require("async/asyncify"),g=require("deepmerge");function d(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var u=d(e),f=d(t),h=d(r),p=d(a),y=d(i),w=d(s),m=d(n),b=d(c),C=d(g),v=e=>[Object,Array].includes((e||{}).constructor)&&!Object.entries(e||{}).length;function k({name:e,workingPath:t}){const r=o.cosmiconfigSync(e).search(t);return v(r)?{}:((e,t,r=null)=>String.prototype.split.call(t,/[,[\].]+?/).filter(Boolean).reduce(((e,t)=>Object.hasOwnProperty.call(e,t)?e[t]:r),e))(r,"config")}var q={twd:".",configs:{"alias.ls":"ls-files","alias.remotes":"remote -v","alias.amend":"!git log -n 1 --pretty=tformat:%s%n%n%b | git commit -F - --amend","alias.fixup":"commit --fixup=HEAD","core.ignorecase":"false","alias.s":"status","alias.p":"push","alias.b":"branch -a -v","alias.cm":"commit -m","alias.tags":"tag -l","alias.co":"checkout","alias.all":"add -A","alias.pl":"pull --ff-only","alias.stashes":"stash list","alias.med":"merge develop","alias.mem":"merge master","alias.l":"log --oneline --color -6","alias.out":"log @{u}..","alias.la":"log -16 --color=always --all --topo-order --pretty='%Cred%h%Creset -%C(yellow)%d%Creset %s %Cgreen(%cr) %C(bold blue)<%an>%Creset' --abbrev-commit --date=relative","alias.ll":"log --color=always --all --topo-order --pretty='%Cred%h%Creset -%C(yellow)%d%Creset %s %Cgreen(%cr) %C(bold blue)<%an>%Creset' --abbrev-commit","alias.lg":"log -10 --color=always --all --graph --topo-order --pretty='%Cred%h%Creset -%C(yellow)%d%Creset %s %Cgreen(%cr) %C(bold blue)<%an>%Creset' --abbrev-commit --date=relative","alias.lgl":"log --color=always --all --graph --topo-order --pretty='%Cred%h%Creset -%C(yellow)%d%Creset %s %Cgreen(%cr) %C(bold blue)<%an>%Creset' --abbrev-commit","alias.wdiff":"diff --color-words"}};async function P(e={twd:".",configs:{}}){const t=C.default(q,e),{twd:r,configs:a}=t,i=await l.Repository.open(r);await async function({repo:e,configs:t}){const r=await e.config();await m.default(t,b.default((async(e,t)=>{await r.setString(t,e)})))}({repo:i,configs:a})}class ${constructor(){f.default({pkg:{name:"setgit-cli",version:"1.1.4"}}).notify(),this.cli=u.default("\n      使用方式\n        $ setgit [工作目录，默认：'process.cwd()']\n\n      选项\n        --version, -v                              查看版本号\n        --help, -h                                 查看帮助\n\n      示例\n        $ setgit                                   为当前工作目录配置 Git\n        $ setgit /usr/pro/api.name.io              为指定工作目录配置 Git\n\n      提示\n        检测到用户未提供自定义配置时，`setgit` 将会使用默认配置，详情参见\n        https://github.com/iTonyYo/setgit-cli#配置。\n    ",{flags:{version:{type:"boolean",alias:"v"},help:{type:"boolean",alias:"h"}}});const e=(t=this.cli.input[0],{twd:v(t)?process.cwd():t,cwd:process.cwd()}).twd;var t;this.workingPath=e,this.userDefinedConfig=k({name:"git",workingPath:e})}async run(){h.default(this.workingPath)?(await P({twd:this.workingPath,configs:this.userDefinedConfig}),this.success()):this.error()}success(){v(this.userDefinedConfig)?console.log(p.default(w.default`
        {bold ${y.default.rainbow("操作成功!")}}
        {grey 检测到您未提供自定义配置，\`setgit\` 使用了默认配置。}

        {grey 操作目录：}
        {grey ${this.workingPath}}
      `)):console.log(p.default(w.default`
      {greenBright.bold ${y.default.rainbow("操作成功!")}}

      {grey 操作目录：}
      {grey ${this.workingPath}}
    `))}error(){console.error(p.default(w.default`
      {redBright.bold 这不是一个 Git 仓库!}

      {grey 操作目录：}
      {grey ${this.workingPath}}
    `))}}(async()=>{try{const e=new $;await e.run()}catch(e){throw e}})();
